<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Post Detail</title>
    <meta charset="UTF-8" />
    <style>
      table {
        border-collapse: collapse;
        width: 80%;
        margin: auto;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
      }
      th {
        background-color: #f2f2f2;
      }
    </style>
    <script>
      function toggleCommentForm() {
        const form = document.getElementById("commentForm");
        form.style.display = form.style.display === "none" ? "block" : "none";
      }
      function modifyComment(commentId) {
        const form = document.getElementById(`modifyComment-${commentId}`);
        form.style.display = form.style.display === "none" ? "inline" : "none";
      }
    </script>
  </head>
  <body>
    <h1 th:text="${post.title}">Post Title</h1>
    <a th:href="@{/post/edit/{id}(id=${post.postId})}">
      <button type="button">수정하기</button>
    </a>
    <form th:action="@{/reaction/{id}(id=${post.postId})}" method="post">
      <input type="hidden" name="reactionType" value="LIKE" />
      <button type="submit">좋아요</button>
    </form>
    <form th:action="@{/reaction/{id}(id=${post.postId})}" method="post">
      <input type="hidden" name="reactionType" value="DISLIKE" />
      <button type="submit">싫어요</button>
    </form>
    <a> 좋아요 : <span th:text="${likeCount}">0</span></a>
    <a> 싫어요 : <span th:text="${dislikeCount}">0</span></a>
    <p>
      <strong>작성자:</strong>
      <span th:text="${post.member.nickname}">작성자 닉네임</span>
    </p>
    <p>
      <strong>작성일:</strong> <span th:text="${post.createdAt}">작성일</span>
    </p>
    <p>
      <strong>조회수:</strong> <span th:text="${post.viewCnt}">조회수</span>
    </p>

    <p><strong>본문 내용:</strong></p>
    <div th:text="${post.content}">본문 내용</div>

    <p>
      <strong>상태:</strong>
      <span th:if="${post.isSolved}">채택됨</span>
      <span th:unless="${post.isSolved}">대기중</span>
    </p>

    <p><strong>태그:</strong></p>
    <ul>
      <li th:each="tag : ${post.tags}" th:text="${tag.name}">태그이름</li>
    </ul>

    <table>
      <thead>
        <tr>
          <th>작성자</th>
          <th>내용</th>
          <th>책이름</th>
          <th>작성일</th>
          <th>상태</th>
          <th>수정하기</th>
          <th>삭제하기</th>
          <th>좋아요&싫어요</th>
          <th>채택하기</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="comment : ${comments}">
          <td th:text="${comment.comment.member.nickname}">작성자</td>
          <td th:text="${comment.comment.content}">내용</td>
          <td th:text="${comment.comment.book.title}">책이름</td>
          <td th:text="${comment.comment.createdAt}">작성일</td>
          <td th:text="${comment.comment.isSelected ? '채택됨' : '대기중'}">
            상태
          </td>
          <td>
            <button
              type="button"
              th:onclick="'modifyComment(' + ${comment.comment.commentId} + ')'"
            >
              수정하기
            </button>

            <form
              th:id="'modifyComment-' + ${comment.comment.commentId}"
              th:action="@{/post/{postId}/comment/edit/{commentId}(postId=${post.postId}, commentId=${comment.comment.commentId})}"
              method="post"
              style="display: none"
            >
              <input
                type="hidden"
                name="commentId"
                th:value="${comment.comment.commentId}"
              />
              <input
                type="text"
                name="newContent"
                placeholder="수정할 내용 입력"
              />
              <button type="submit">저장</button>
            </form>
          </td>
          <td>
            <form
              th:action="@{/post/{postId}/comment/{commentId}(postId=${post.postId}, commentId=${comment.comment.commentId})}"
              method="post"
            >
              <button type="submit">삭제하기</button>
            </form>
          </td>
          <td>
            <form
              th:action="@{/reaction/{postId}/{id}(postId=${post.postId}, id=${comment.comment.commentId})}"
              method="post"
            >
              <input type="hidden" name="reactionType" value="LIKE" />
              <button type="submit">
                좋아요 <span th:text="${comment.likeCount}">0</span>
              </button>
            </form>
            <form
              th:action="@{/reaction/{postId}/{id}(postId=${post.postId}, id=${comment.comment.commentId})}"
              method="post"
            >
              <input type="hidden" name="reactionType" value="DISLIKE" />
              <button type="submit">
                싫어요 <span th:text="${comment.dislikeCount}">0</span>
              </button>
            </form>
          </td>
          <td>
            <form
              th:action="@{/post/{postId}/select/{commentId}(postId=${post.postId}, commentId=${comment.comment.commentId})}"
              method="post"
              th:if="${!post.isSolved}"
            >
              <button type="submit">채택하기</button>
            </form>
            <p th:if="${comment.comment.isSelected}">채택됨</p>
          </td>
        </tr>
      </tbody>
    </table>
    <button type="button" onclick="toggleCommentForm()">댓글 작성</button>

    <form
      id="commentForm"
      th:action="@{/post/{postId}/comment(postId=${post.postId})}"
      method="post"
      style="display: none"
    >
      <input type="hidden" name="postId" th:value="${post.postId}" />

      <p>제목: <input type="text" name="title" placeholder="책 제목 입력" /></p>
      <p>저자 : <input type="text" name="author" placeholder="저자 입력" /></p>
      <p>내용:</p>
      <textarea
        name="content"
        rows="3"
        cols="40"
        placeholder="추천 이유"
      ></textarea>

      <br />
      <button type="submit">댓글 등록</button>
    </form>
  </body>
</html>
